--- 
title: "NHIS Anxiety Analysis in Adults"
author: "Zhe Wang, Yingyi Zhu, Zixiao Zhang"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
---
```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```

# Introduction

In today's rapidly developing and competitive society, almost everyone has a certain degree of anxiety, which is manifested in a variety of mild or severe psychological diseases and behavioral symptoms. When it comes to school, we are afraid that we can not complete the study task well and get a bad result. When it comes to the job, we may doubt our abilities and fear not finding a job. When it comes to inquires from family and friends, we are also afraid of disappointing those who care about us. When it comes to interpersonal relationships, we often fear contact with strangers and worry that our language or behavior will suffer from the negative evaluation of others. These can be seen as signs of anxiety. We started studying this topic because we are also facing more or less stress nowadays. We often feel the negative emotions caused by anxiety. So what we want to see from the data is how anxiety affects our life and health or how it relates to each other. 

<!--chapter:end:index.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Proposal
## Research topic

  Occasional anxiety is a normal part of life. Being a student at Columbia University, it's not uncommon to hear phrases such as being stressed about school work, midterms, and career searching. One news [article](https://www.who.int/news/item/02-03-2022-covid-19-pandemic-triggers-25-increase-in-prevalence-of-anxiety-and-depression-worldwide) from the **World Health Organization** even revealed that the prevalence of anxiety and depression has increased by 25% globally during the social environment of the COVID-19 pandemic. Furthermore, anxiety may interfere with daily activities, such as work performance, schoolwork, and relationships. Physical symptoms can include rapid heartbeat, tremors, breathlessness, and other symptoms such as upset stomach or nausea.

  For this exploratory data project, our team will look at a four-year NHIS data on 18-65 aged adults, focusing on the relationship between anxiety and other general factors such as gender and employment. Moreover, we will further our analysis by looking at other health factors like heart disease that could be correlated with feelings of anxiety.

## Data availability
  The [National Health Interview Survey](https://www.cdc.gov/nchs/nhis/data-questionnaires-documentation.htm)
 data we utilized was collected and processed by the National Center for Health
Statistics (NCHS). It is a cross-sectional household interview survey conducted through a geographic subgroup sampling technique (random selection), updated annually. The data contains statistical information on the interviewer's health status, health-related behaviors, and healthcare utilization history since 1993.

  We will limit our analysis to the recent years, 2018-2021 survey data only, and within the group
of 18-65 aged adults. The sample adult population of each year would be approximately 30,000. The data format we will be using will be CSV format. The total size over the four years adults data would be 112MB, including elders, which we would feature engineer later to exclude. We intended to import the CSV files to R studios by used the built-in read.csv(...) function call to conduct data cleaning and visualization of the relationship of anxiety between the following factors that were found in all four years of surveys: 

  For common independent factors, we have ages, years (split to Covid/non-Covid), marital status,
genders, races, sexual orientations, household numbers, regions, habits (such as smoking, alcohol, etc.), employment, history of chronic pains and hours of sleep. The list's order is random and does not have ranks of importance. We include these factors to help us understand our samples and the distribution of anxiety in the population, such as genders and regions. If the sample population distribution is highly imbalanced, we will thus adjust our strategies correspondingly by downsampling or upsampling.

  Additional to the common independent factors, we would further explore certain physical health
factors we found might be correlated: history of heart disease, history of cancer, history of stroke, history of diabetes, and history of asthma. Again, the order of the list above is random. We are interested in exploring the relationship between these above factors because many studies have shown mental health is correlated with physical health to different degrees. We would, therefore, like to examine the degree of correlation.

  One additional comment regarding our data is that it’s interview survey data, which are answered
without 100% truth guarantees. It’s possible the interviewees chose to give inaccurate information out of self-interest. Moreover, the health-related questions are also self-answered, which means there is not necessarily a formal background check to confirm. We don’t know if some health conditions have been cured. Therefore, we decided to use terms such as “history of anxiety” and “history of cancers” to adjust the level of accuracy.

  In summary, we will explore the relationship between anxiety(self-indicated or formally
diagnosed) with other factors, such as age, gender, and years, with a further focus on physical conditions. The NHIS data will help us achieve a four-year exploration with a rich sample adult population of around 30,000 each year. We will keep in mind the inaccuracy that comes with the nature of the NHIS data collection process.

Here is a link to the NHIS data: 
[National Health Interview Survey](https://www.cdc.gov/nchs/nhis/data-questionnaires-documentation.htm)

<!--chapter:end:proposal.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Data 

## Sources

```{r include=FALSE}
library(readr)
download.file("https://ftp.cdc.gov/pub/Health_Statistics/NCHS/Datasets/NHIS/2021/adult21csv.zip", destfile = "adult21.zip")
download.file("https://ftp.cdc.gov/pub/Health_Statistics/NCHS/Datasets/NHIS/2020/adult20csv.zip", destfile="adult20.zip")
download.file("https://ftp.cdc.gov/pub/Health_Statistics/NCHS/Datasets/NHIS/2019/adult19csv.zip", destfile="adult19.zip")
download.file("https://ftp.cdc.gov/pub/Health_Statistics/NCHS/Datasets/NHIS/2018/samadultcsv.zip", destfile="adult18.zip")
data2021 <- unzip("adult21.zip")
data2020 <- unzip("adult20.zip")
data2019 <- unzip("adult19.zip")
data2018 <- unzip("adult18.zip")
NHIS_2021 <- readr::read_csv("adult21.csv", show_col_types = FALSE)
NHIS_2020 <- readr::read_csv("adult20.csv", show_col_types = FALSE)
NHIS_2019 <- readr::read_csv("adult19.csv", show_col_types = FALSE)
NHIS_2018 <- readr::read_csv("samadult.csv", show_col_types = FALSE)
```


```{r}
library(dplyr)
library(tidyr)
library(ggplot2)
library(tibble)
library(forcats)
library(vcdExtra)
library(redav)
library(GGally)
library(ggalluvial)
NHIS_2019 <- select(NHIS_2019, c('ANXEV_A', 'AGEP_A', 'MARITAL_A', 'SEX_A', 'HISPALLP_A', 'ORIENT_A', 'REGION', 'SMKNOW_A', 'EMPWRKLSWK_A', 'PAIFRQ3M_A', 'CHDEV_A', 'CANEV_A', 'STREV_A', 'DIBEV_A', 'ASEV_A'))

NHIS_2020 <- select(NHIS_2020, c('ANXEV_A', 'AGEP_A', 'MARITAL_A', 'SEX_A', 'HISPALLP_A', 'ORIENT_A', 'REGION', 'SMKNOW_A', 'EMPWRKLSWK_A', 'PAIFRQ3M_A', 'CHDEV_A', 'CANEV_A', 'STREV_A', 'DIBEV_A', 'ASEV_A'))

NHIS_2021 <- select(NHIS_2021, c('ANXEV_A', 'AGEP_A', 'MARITAL_A', 'SEX_A', 'HISPALLP_A', 'ORIENT_A', 'REGION', 'SMKNOW_A', 'EMPWRKLSW1_A', 'PAIFRQ3M_A', 'CHDEV_A', 'CANEV_A', 'STREV_A', 'DIBEV_A', 'ASEV_A'))

col_names = c("History_of_Anxiety", "Age", "Marital_Status", "Sex", "Race", "Sexual_Orientation", "Region", "Smoking", "Employment", "Chronic_pain", "History_of_Heart_disease", "History_of_Cancer", "History_of_Stroke", "History_of_Diabetes", "History_of_Asthma")

colnames(NHIS_2019) <- col_names
colnames(NHIS_2020) <- col_names
colnames(NHIS_2021) <- col_names
```


```{r}
data_cleaner <- function(df, year,Covid){
  df_test <- df
  
  df_test$Year <- year
  df_test$Covid_Year <- Covid
  
  #df_test[is.na(df_test)] = 'Missing'
  
  df_test <- subset(df_test, Age>=18 & Age <= 65)
  
  df_test <- df_test %>% mutate_at(
                  c('History_of_Anxiety','History_of_Heart_disease','History_of_Cancer','History_of_Stroke',
                    'History_of_Diabetes','History_of_Asthma','Employment'),  ~ case_when(
                                          . == 1 ~ "Yes",
                                          . == 2 ~ "No",
                                          . == 7 ~ "Refused",
                                          . == 8 ~ "Do not know",
                                          . == 9 ~ "Do not know",
                                          TRUE ~ "Missing"))
  df_test <- df_test%>% mutate_at(
                  c('Marital_Status'),  ~ case_when(
                                          . == 1 ~ "Married",
                                          . == 2 ~ "Unmarried",
                                          . == 3 ~ "Unmarried",
                                          . == 7 ~ "Refused",
                                          . == 8 ~ "Do not know",
                                          . == 9 ~ "Do not know",
                                          TRUE ~ "Missing"))
  df_test <- df_test%>% mutate_at(
                  c('Sex'),  ~ case_when(
                                          . == 1 ~ "Male",
                                          . == 2 ~ "Female",
                                          . == 7 ~ "Refused",
                                          . == 8 ~ "Do not know",
                                          . == 9 ~ "Do not know",
                                          TRUE ~ "Missing"))

  df_test <- df_test%>% mutate_at(
                  c('Race'),  ~ case_when(
                                          . == 02 ~ "White",
                                          . == 03 ~ "Black",
                                          . == 04 ~ "Asian",
                                          . == 01 ~ "Others",
                                          . == 05 ~ "Others",
                                          . == 06 ~ "Others",
                                          . == 07 ~ "Others",
                                          . == 97 ~ "Refused",
                                          . == 98 ~ "Do not know",
                                          . == 99 ~ "Do not know",
                                          TRUE ~ "Missing"
                                        ))
  df_test <- df_test %>% mutate_at(
                  c('Sexual_Orientation'),  ~ case_when(
                                          . == 1 ~ "Gay_Lesbian",
                                          . == 2 ~ "Straight",
                                          . == 3 ~ "Bisexual",
                                          . == 4 ~ "Others",
                                          . == 5 ~ "Others",
                                          . == 7 ~ "Refused",
                                          . == 8 ~ "Do not know",
                                          . == 9 ~ "Do not know",
                                          TRUE ~ "Missing"
                                        ))
  df_test <- df_test%>% mutate_at(
                  c('Region'),  ~ case_when(
                                          . == 1 ~ "Northeast",
                                          . == 2 ~ "Midwest",
                                          . == 3 ~ "South",
                                          . == 4 ~ "West",
                                          TRUE ~ "Missing"
                                        ))
  df_test <- df_test%>% mutate_at(
                  c('Chronic_pain'), ~ case_when(
                                          . == 1 ~ "Never",
                                          . == 2 ~ "Some days",
                                          . == 3 ~ "Most days",
                                          . == 4 ~ "Every day",
                                          . == 7 ~ "Refused",
                                          . == 8 ~ "Do not know",
                                          . == 9 ~ "Do not know",
                                          TRUE ~ "Missing"
                                        ))
    df_test <- df_test%>% mutate_at(
                  c('Smoking'),  ~ case_when(
                                          . == 1 ~ "Every day",
                                          . == 2 ~ "Some days",
                                          . == 3 ~ "Not at all",
                                          . == 7 ~ "Refused",
                                          . == 8 ~ "Do not know",
                                          . == 9 ~ "Do not know",
                                          TRUE ~ "Missing"
                                        ))

  return(df_test)
}
```


```{r}
NHIS_2019_test = data_cleaner(NHIS_2019,year = 2019,Covid='No')
NHIS_2020_test = data_cleaner(NHIS_2020,year = 2020,Covid='Yes')
NHIS_2021_test = data_cleaner(NHIS_2021,year = 2021,Covid='Yes')
```


```{r}
df <- select(NHIS_2018, c('AFLHCA17', 'AGE_P', 'R_MARITL', 'SEX', 'MRACRPI2', 'ASISIM', 'ASISIF', 'REGION', 'SMKNOW', 'DOINGLWA', 'PAIN_2A', 'CHDEV', 'CANEV', 'STREV', 'DIBEV1', 'AASMEV'))

colnames(df) <- c("History_of_Anxiety", "Age", "Marital_Status", "Sex", "Race", "Sexual_Orientation_Male", "Sexual_Orientation_Female", "Region", "Smoking", "Employment", "Chronic_pain", "History_of_Heart_disease", "History_of_Cancer", "History_of_Stroke", "History_of_Diabetes", "History_of_Asthma")
df$Year <- 2018
df$Covid_Year <- 'No'
df$Sexual_Orientation <- coalesce(df$Sexual_Orientation_Male, df$Sexual_Orientation_Female)
df <- subset (df, select = -c(Sexual_Orientation_Male, Sexual_Orientation_Female))
df <- subset(df, Age>=18 & Age <= 65) 

df1 <- df%>%
  mutate(
    History_of_Anxiety = case_when(df$History_of_Anxiety == 1 ~ 'Yes', df$History_of_Anxiety == 2 ~ 'No',
                                   df$History_of_Anxiety == 7 ~ "Refused",
                              df$History_of_Anxiety == 8 ~ "Do not know",
                              df$History_of_Anxiety == 9 ~ "Do not know",
                        TRUE ~ 'Missing'),
    Marital_Status = case_when(df$Marital_Status == 1 | df$Marital_Status == 2 | df$Marital_Status == 3 ~ 'Married',
                               df$Marital_Status == 0 | df$Marital_Status == 4 | df$Marital_Status == 5 | df$Marital_Status == 6 | df$Marital_Status == 7 |  df$Marital_Status == 8 ~ 'Unmarried',
                                          df$Marital_Status == 9 ~ "Do not know",
                               TRUE ~ 'Missing'),
    Race = case_when(df$Race == 1 ~ 'White',
                     df$Race == 2 ~ 'Black',
                     df$Race == 9 | df$Race == 10 | df$Race == 11 | df$Race == 15 ~ 'Asian',
                     df$Race == 3 ~ 'Others',
                     TRUE ~ 'Missing'),
    Smoking = case_when(df$Smoking == 1 ~ "Every day",
                        df$Smoking == 2 ~ "Some days",
                        df$Smoking == 3 ~ "Not at all",
                        df$Smoking == 7 ~ "Refused",
                        df$Smoking == 8 ~ "Do not know",
                        df$Smoking == 9 ~ "Do not know",
                        TRUE ~ 'Missing'),
    Sex = case_when(df$Sex == 1 ~ 'Male', df$Sex == 2 ~ 'Female', 
                         TRUE ~ 'Missing'),
    Sexual_Orientation = case_when(df$Sexual_Orientation == 1 ~ 'Gay_Lesbian',
                          df$Sexual_Orientation == 2 ~ 'Straight',
                          df$Sexual_Orientation == 3 ~ 'Others',
                          TRUE ~ 'Missing'),
    Employment = case_when(df$Employment == 1 | df$Employment == 2 | df$Employment == 4 ~ 'Yes',
                           df$Employment == 3 | df$Employment == 5 ~ 'No',
                          df$Employment == 7 ~ "Refused",
                        df$Employment == 8 ~ "Do not know",
                        df$Employment == 9 ~ "Do not know",
                           TRUE ~ 'Missing'),
    Region = case_when(df$Region == 1 ~ 'Northeast',
                       df$Region == 2 ~ 'Midwest',
                       df$Region == 3 ~ 'South',
                       df$Region == 4 ~ 'West',
                       TRUE ~ 'Missing'),
    Chronic_pain = case_when(df$Chronic_pain == 1 ~ 'Never',
                             df$Chronic_pain == 2 ~ 'Some days',
                             df$Chronic_pain == 3 ~ 'Most days',
                             df$Chronic_pain == 4 ~ 'Every day',
                             df$Chronic_pain== 7 ~ "Refused",
                              df$Chronic_pain == 8 ~ "Do not know",
                              df$Chronic_pain == 9 ~ "Do not know",
                             TRUE ~ 'Missing'),
    History_of_Heart_disease = case_when(df$History_of_Heart_disease == 1 ~ 'Yes',
                              df$History_of_Heart_disease == 2 ~ 'No',
                              df$History_of_Heart_disease== 7 ~ "Refused",
                              df$History_of_Heart_disease == 8 ~ "Do not know",
                              df$History_of_Heart_disease == 9 ~ "Do not know",
                              TRUE ~ 'Missing'),
    History_of_Cancer = case_when(df$History_of_Cancer == 1 ~ 'Yes',
                              df$History_of_Cancer == 2 ~ 'No',
                              df$History_of_Cancer == 7 ~ "Refused",
                              df$History_of_Cancer == 8 ~ "Do not know",
                              df$History_of_Cancer == 9 ~ "Do not know",
                              TRUE ~ 'Missing'),
    History_of_Stroke  = case_when(df$History_of_Stroke  == 1 ~ 'Yes',
                              df$History_of_Stroke == 2 ~ 'No',
                              df$History_of_Stroke == 7 ~ "Refused",
                              df$History_of_Stroke == 8 ~ "Do not know",
                              df$History_of_Stroke == 9 ~ "Do not know",
                              TRUE ~ 'Missing'),
    History_of_Diabetes = case_when(df$History_of_Diabetes  == 1 ~ 'Yes',
                              df$History_of_Diabetes == 2 ~ 'No',
                              df$History_of_Diabetes == 7 ~ "Refused",
                              df$History_of_Diabetes == 8 ~ "Do not know",
                              df$History_of_Diabetes == 9 ~ "Do not know",
                              TRUE ~ 'Missing'),
    History_of_Asthma = case_when(df$History_of_Asthma  == 1 ~ 'Yes',
                              df$History_of_Asthma == 2 ~ 'No',
                              df$History_of_Asthma == 7 ~ "Refused",
                              df$History_of_Asthma == 8 ~ "Do not know",
                              df$History_of_Asthma == 9 ~ "Do not know",
                              TRUE ~ 'Missing')
    )

NHIS_2018_test = df1
```

The data we use are from the National Health Interview Survey. It contains the results of interviews with about 30,000 people per year. The National Center for Health Surveys collects and processes the survey data. (hereafter referred to as NCHS) Each year, NCHS conducts a cross-sectional household interview survey of a specific population at a specific time through a geographic subgroup sampling technique. After the survey, they process the data, store it in a CSV file, and provide documentation that describes the meaning of each column and the keywords of the questions.

The NCHS website can find the survey data for each year from 1993 to 2021. We selected the recent four years of data for analysis. Since most of the questions interviewed in recent years were similar, we could easily find overlaps in the data and analyze them. Secondly, we also expected to know whether covid-19 is a factor that affects anxiety. Therefore, we selected data from two years before and two years after the pandemic. 

```{r}
NHIS_final <- rbind(NHIS_2019_test, NHIS_2020_test, NHIS_2021_test, NHIS_2018_test)
str(NHIS_final)
```

After the process of data cleanups, we have the data information shown in the figure above. The final data will contain 17 columns, with all categorical variables except for age. The most frequent values are yes or no, which is consistent with the characteristics of survey data. For each year of data, there are nearly 30,000 people, and we set the target group at 18 to 65 years old. So after filtering out other age groups, we end up with 84975 rows. 

Before we cleaned the data, we considered that there would be missing data as common sense dictates that respondents would not be forced to answer every question.  This also became apparent after we cleaned the data, as several columns had missing values, and not all answers were valuable.  Some people refuse to answer the questions or answers they don't know.  This could be a potential problem for the accuracy of our data.

## Cleaning / transformation

The data we are looking for on the official NCHS website is a compressed file ending in ".zip". In this case, we use the URL to read it. Then we unzip it to extract the CSV file. Since we will be using four years of data, this step needs to be repeated four times.

In the original document, each column corresponds to a survey question. Using the question as a column name is not practical because it is very long. Therefore, the column names in the file are labelled with a combination of letters and numbers. NCHS provides the documentation to help us understand each column's meaning and the corresponding survey question. Once we have confirmed the columns we need to use by searching for keywords, we use select to retrieve these columns from each year of data. We know the characteristics of each column, but the viewer may have yet to have the opportunity to read the documentation. Therefore, we need to change the names of the columns so that the viewer understands the values they are referring to. It will also be easier for us to use during the rest of the exploratory data analysis.

Next, we notice that the column values are labelled by the numbers 1, 2, 3, 4, etc. Just like the answers to the multiple-choice questions. So to convert the column values into easy-to-read text, we open the documentation again, which indicates the answer for each number. By using mutate, we converted each column's values into easy-to-understand words. After this cleaning of the data, we can start the subsequent analysis.

## Missing value analysis
```{r fig.width=22, fig.height=10}
NHIS_Missing <- NHIS_final %>%
  select("History_of_Anxiety", "Smoking","Age", "Marital_Status", "Sex", "Race", "Sexual_Orientation", "Region", "Employment", "Chronic_pain", "History_of_Heart_disease", "History_of_Cancer", "History_of_Stroke", "History_of_Diabetes", "History_of_Asthma") %>%
  mutate(History_of_Anxiety = na_if(History_of_Anxiety, "Missing")) %>%
  mutate(Age = na_if(Age, "Missing")) %>%
  mutate(Marital_Status = na_if(Marital_Status, "Missing")) %>%
  mutate(Sex = na_if(Sex, "Missing")) %>%
  mutate(Race = na_if(Race, "Missing")) %>%
  mutate(Smoking= na_if(Smoking, "Missing")) %>%
  mutate(Sexual_Orientation = na_if(Sexual_Orientation, "Missing")) %>%
  mutate(Region = na_if(Region, "Missing")) %>%
  mutate(Employment = na_if(Employment, "Missing")) %>%
  mutate(Chronic_pain = na_if(Chronic_pain, "Missing")) %>%
  mutate(History_of_Heart_disease = na_if(History_of_Heart_disease, "Missing")) %>%
  mutate(History_of_Cancer = na_if(History_of_Cancer, "Missing")) %>%
  mutate(History_of_Stroke = na_if(History_of_Stroke, "Missing")) %>%
  mutate(History_of_Diabetes = na_if(History_of_Diabetes, "Missing")) %>%
  mutate(History_of_Asthma = na_if(History_of_Asthma, "Missing"))

plot_missing(NHIS_Missing, percent = FALSE)
```

The data we use is based on the interviewer's responses. Because of the interview data and the fact that it is not mandatory to answer each question, we have values for many questions that are missing. That is, the interviewees chose not to answer the question. With four years of data, we will deal with a large portion of missing values. We tried to use a heatmap to visualize the missing values in rows and columns, but because of the large amount of data. It is not possible to plot the whole graph. So we chose to use plot_missing() from redav to help us see if there are any patterns hidden in these missing values.

Based on the results above, we can see that for the more basic personal information such as age, gender and region. The interviewees are willing to choose to answer. This is not difficult to understand, as we mentioned that each year's interview population was randomly selected through a geographic subgroup sampling technique. The area of residence of the popular respondents at the time of the interview was also not non-disclosed. In the case of the more personal questions about personal health and sexual orientation, there are a large number of missing values. Therefore, we can see that the interviewees are still more concerned about their privacy. This also reflects the uncertainty of the data we use. The missing values of columns show that the overlap of the Smoking, History of Anxiety, and Sexual Orientation columns is slightly relatively high. However, there is no obvious pattern. Therefore, there is no significant pattern of missing values in the dataset. 

<!--chapter:end:data.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Results

```{r}
library(dplyr)
library(tidyr)
library(grid)
library(ggplot2)
library(GGally)
library(ggalluvial)
```

##Percentage of interviewees with Anxiety Over 4 years, by gender##
```{r echo=FALSE}
options(dplyr.summarise.inform = FALSE)
nhisBar <- NHIS_final %>%
  filter(History_of_Anxiety !='Missing') %>%
  filter(Sex=="Male" | Sex=="Female")
nhisBar1 <- nhisBar %>%
  group_by(Year, History_of_Anxiety, Sex) %>%
  dplyr::summarise(Freq = n())
ggplot(nhisBar1, aes(x = Year, y=Freq, fill = History_of_Anxiety)) + 
    geom_bar(position="fill", stat="identity") +
  facet_wrap(~Sex) +
  scale_fill_manual(values = c("#FAE367", "#768CCe", "#E7BCC6", "#B4BBC0"), limits = c("Yes", "No", "Refused", "Do not know")) +
  theme_minimal()
```

Although the population interviewed each year was not a fixed group of people, we have no way of knowing whether the same group of people had a change in their mental health during those years. However, according to the graph above, the percentage of interviewees with anxiety disorders has increased yearly—both the percentage of males and females. On the male side, we can see that the increase is relatively small, but there is no sign of a decrease. The increase from 2018 to 2019 is more significant on the female side. The increase is almost 50% of those with anxiety disorders in 2018. The increase continues each year slowly after that. 
We can also note that the proportion of women with anxiety disorders is greater than that of men, with almost 25% of women having anxiety disorders by 2021. 

## "Anxiety and Identity: The Intersection of Race and Sex"
```{r}
options(dplyr.summarise.inform = FALSE)
df$Race  <- factor(df$Race,c('White','Others','Black','Asian') )
df$Race  <-as.ordered(df$Race)

counts2 <- df %>%
  group_by(Race,Sex,History_of_Anxiety) %>%
  summarize(Freq = sum(Freq))


vcd::mosaic(History_of_Anxiety ~ Sex + Race, counts2,
            direction = c("h", "v", "h"),
            highlighting_fill = icecreamcolors)
```

Anxiety among different genders still follows the pattern from the first plot, with females being more likely to experience anxiety than males. However, if we break down the data by race, we can see that females in the "other" category are more likely to experience anxiety than Black and Asian females, compared to males.

## "The Burden of Chronic Pain: Exploring the Prevalence and Impact of Chronic Pain among sex"
```{r}
# alluvium plot
counts2 <- df %>%
  group_by(History_of_Anxiety,Chronic_pain,Sex) %>%
  summarize(Freq = sum(Freq))


ggplot(counts2, aes(axis = History_of_Anxiety, axis3 = Chronic_pain, axis2 = Sex,  y = Freq)) +
  geom_alluvium(aes(fill = History_of_Anxiety), width = 1/12) +
  geom_stratum() +
  geom_text(stat = "stratum", aes(label = paste(after_stat(stratum), "\n", after_stat(count)))) +
  scale_x_discrete(limits = c("History_of_Anxiety", "Chronic_pain", "Smoking"))
```

##Anxiety vs. Physical Diseases##
```{r}
orderedclasses <- c("Yes", "No", "Refused", "Do not Know", "Missing")
mydata <- NHIS_final %>%
  select("History_of_Anxiety","History_of_Heart_disease")
mydata$History_of_Anxiety <- factor(mydata$History_of_Anxiety, levels = orderedclasses)
mydata$History_of_Heart_disease <- factor(mydata$History_of_Heart_disease, levels = orderedclasses)
mydata1 <- mydata %>%
  group_by(History_of_Anxiety, History_of_Heart_disease) %>%
  dplyr::summarise(Freq=n()) 
mydata1 <- mydata1 %>% group_by(History_of_Anxiety) %>% 
  mutate(Total = sum(Freq)) %>% ungroup()

mydata2 <- NHIS_final %>%
  select("History_of_Anxiety","History_of_Cancer")
mydata2$History_of_Anxiety <- factor(mydata2$History_of_Anxiety, levels = orderedclasses)
mydata2$History_of_Cancer <- factor(mydata2$History_of_Cancer, levels = orderedclasses)
mydata3 <- mydata2 %>%
  group_by(History_of_Anxiety, History_of_Cancer) %>%
  dplyr::summarise(Freq=n()) 
mydata3 <- mydata3 %>% group_by(History_of_Anxiety) %>% 
  mutate(Total = sum(Freq)) %>% ungroup()

mydata4 <- NHIS_final %>%
  select("History_of_Anxiety","History_of_Stroke")
mydata4$History_of_Anxiety <- factor(mydata4$History_of_Anxiety, levels = orderedclasses)
mydata4$History_of_Stroke <- factor(mydata4$History_of_Stroke, levels = orderedclasses)
mydata5 <- mydata4 %>%
  group_by(History_of_Anxiety, History_of_Stroke) %>%
  dplyr::summarise(Freq=n()) 
mydata5 <- mydata5 %>% group_by(History_of_Anxiety) %>% 
  mutate(Total = sum(Freq)) %>% ungroup()
```

```{r}
mydata6 <- NHIS_final %>%
  select("History_of_Anxiety","History_of_Diabetes")
mydata6$History_of_Anxiety <- factor(mydata6$History_of_Anxiety, levels = orderedclasses)
mydata6$History_of_Diabetes <- factor(mydata6$History_of_Diabetes, levels = orderedclasses)
mydata7 <- mydata6%>%
  group_by(History_of_Anxiety, History_of_Diabetes) %>%
  dplyr::summarise(Freq=n()) 
mydata7 <- mydata7 %>% group_by(History_of_Anxiety) %>% 
  mutate(Total = sum(Freq)) %>% ungroup()
```

```{r}
mydata8 <- NHIS_final %>%
  select("History_of_Anxiety","History_of_Asthma")
mydata8$History_of_Anxiety <- factor(mydata8$History_of_Anxiety, levels = orderedclasses)
mydata8$History_of_Asthma <- factor(mydata8$History_of_Asthma, levels = orderedclasses)
mydata9 <- mydata8%>%
  group_by(History_of_Anxiety, History_of_Asthma) %>%
  dplyr::summarise(Freq=n()) 
mydata9 <- mydata9 %>% group_by(History_of_Anxiety) %>% 
  mutate(Total = sum(Freq)) %>% ungroup()
```


```{r fig.width=9, fig.height=8}
h1 <- ggplot(subset(subset(mydata1, !is.na(History_of_Heart_disease)), !is.na(History_of_Anxiety)), aes(x = History_of_Anxiety, y = History_of_Heart_disease)) +
  geom_tile(aes(fill = (Freq/Total)), color = "white") +
  coord_fixed() + 
  scale_fill_gradientn(colors=c("#aacfe5", "#3888c0", "#08336e"))+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1))+
  labs(fill = "Freq in Anxiety")

h2 <- ggplot(subset(subset(mydata3, !is.na(History_of_Cancer)), !is.na(History_of_Anxiety)), aes(x = History_of_Anxiety, y = History_of_Cancer)) +
  geom_tile(aes(fill = (Freq/Total)), color = "white") +
  coord_fixed() + 
  scale_fill_gradientn(colors=c("#aacfe5", "#3888c0", "#08336e"))+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1))+
  labs(fill = "Freq in Anxiety")

h3 <- ggplot(subset(subset(mydata5, !is.na(History_of_Stroke)), !is.na(History_of_Anxiety)), aes(x = History_of_Anxiety, y = History_of_Stroke)) +
  geom_tile(aes(fill = (Freq/Total)), color = "white") +
  coord_fixed() + 
  scale_fill_gradientn(colors=c("#aacfe5", "#3888c0", "#08336e"))+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1))+
  labs(fill = "Freq in Anxiety")

h4 <- ggplot(subset(subset(mydata7, !is.na(History_of_Diabetes)), !is.na(History_of_Anxiety)), aes(x = History_of_Anxiety, y = History_of_Diabetes)) +
  geom_tile(aes(fill = (Freq/Total)), color = "white") +
  coord_fixed() + 
  scale_fill_gradientn(colors=c("#aacfe5", "#3888c0", "#08336e"))+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1))+
  labs(fill = "Freq in Anxiety")

h5 <- ggplot(subset(subset(mydata9, !is.na(History_of_Asthma)), !is.na(History_of_Anxiety)), aes(x = History_of_Anxiety, y = History_of_Asthma)) +
  geom_tile(aes(fill = Freq/Total), color = "white") +
  coord_fixed() + 
  scale_fill_gradientn(colors=c("#aacfe5", "#3888c0", "#08336e"))+
  theme(axis.text.x = element_text(angle = 70, vjust = 1, hjust=1)) +
  labs(fill = "Freq in Anxiety")
gridExtra::grid.arrange(h1, h2, h3, h4,h5)
```

In the above five plots, the x-axis represents the interviewee population's different responses to the history of Anxiety. The y-axis corresponds to the responses for other physical diseases. For each response to Anxiety, we tried to find the proportion of responses for other diseases. For example, the first graph contains variables of history of Anxiety and history of heart disease.
Among those who had Anxiety, more than 75% chose no, which means more than 75% of people do not have heart disease.
After comparing Anxiety with other diseases, we can see that the percentage of people who answered yes to both asthma and a history of Anxiety is the highest among the five diseases. We can probably assume that there is a relationship between them. 

##Exploring the Relationship Between Diseases##

```{r}
nhisAnxiety <- NHIS_final %>%
  select(History_of_Anxiety, Year)
anxiety<-as.data.frame(table(NHIS_final$History_of_Anxiety))


nhisHeart <- NHIS_final %>%
  select(History_of_Heart_disease)
heart<-as.data.frame(table(NHIS_final$History_of_Heart_disease))

nhisCancer <- NHIS_final %>%
  select(History_of_Cancer)
cancer<-as.data.frame(table(NHIS_final$History_of_Cancer))

nhisStroke <- NHIS_final %>%
  select(History_of_Stroke)
stroke<-as.data.frame(table(NHIS_final$History_of_Stroke))

nhisDiabetes <- NHIS_final %>%
  select(History_of_Diabetes)
diabetes<-as.data.frame(table(NHIS_final$History_of_Diabetes))

nhisAsthma <- NHIS_final %>%
  select(History_of_Asthma)
asthma<-as.data.frame(table(NHIS_final$History_of_Asthma))
```

```{r}
heat1 <- inner_join(x=anxiety, y=heart, by="Var1")
heat2 <- inner_join(x=heat1, y=cancer, by="Var1")
heat3 <- inner_join(x=heat2, y=stroke, by="Var1")
heat4 <- inner_join(x=heat3, y=diabetes, by="Var1")
heat5 <- inner_join(x=heat4, y=asthma, by="Var1")
colnames(heat5)[1:7] =c("Answer", "Anxiety","Heart_disease", "Cancer", "Stroke", "Diabetes", "Asthma")
draw_biplot(heat5, points=FALSE)
```

The loading plots include vectors for each disease, including anxiety. We note that the vectors for anxiety disorders and asthma patients are relatively close. From our study of the biplot, we know that forming a small angle means that the two variables are positively correlated. Combining this with our findings in the previous heatmap, there is a link between anxiety and asthma. Second, we can also note that the angle between the history of anxiety and other disorders is between 75 and 100 degrees, which means they are not likely to be correlated.

##Anxiety Among Ages##

```{r}

nhisCleve <- NHIS_final %>%
  filter(History_of_Anxiety !='Missing') 
nhisCleve$History_of_Anxiety <- factor(nhisCleve$History_of_Anxiety)
nhisCleve1 <- nhisCleve %>%
  group_by(Age, History_of_Anxiety) %>%
  dplyr::summarise(freq=n()) 
nhisCleve2 <- nhisCleve1%>%
  mutate(Total = sum(freq))
nhisCleve3 <- nhisCleve2%>%
  mutate(pro = freq/Total)
ggplot(nhisCleve3, aes(x = pro, y = Age)) +
 geom_point(aes(color = History_of_Anxiety))+
  scale_color_manual(values = c("#FAE367", "#768CCe", "#E7BCC6", "#B4BBC0"), limits = c("Yes", "No", "Refused", "Do not know")) +
  theme_linedraw()

```

The proportion of anxiety is relatively even across all ages. It remains below 25 percent. However, it is easy to see from the graph that the older the age, the lower the proportion. The prevalence of anxiety disorders in 23- and 24-year-olds is a little higher than in other age groups. The younger the person, the smaller the number of people who have had anxiety disorders. By age 65, the percentage had dropped to less than 12 percent.

##Can smoking reduce anxiety?##

```{r}
nhisBar2 <- NHIS_final %>%
  filter(History_of_Anxiety !='Missing') %>%
  filter(Smoking !='Missing' & Smoking != 'Do not know' & Smoking!='Refused') 
nhisBar3 <- nhisBar2 %>%
  group_by(History_of_Anxiety,Smoking) %>%
  dplyr::summarise(Freq = n())
ggplot(nhisBar3, aes(x = Smoking, y=Freq, fill = History_of_Anxiety)) + 
    geom_bar(position="fill", stat="identity") +
  scale_fill_manual(values = c("#FAE367", "#768CCe", "#E7BCC6", "#B4BBC0"), limits = c("Yes", "No", "Refused", "Do not know")) +
  scale_x_discrete(limits = c("Every day", "Some days", "Not at all"))+
  theme_minimal()
```

According to our perceptions, smoking is a form of stress relief for some people who have just started smoking. Many smokers experience relief from anxiety after smoking. But is this true? The chart above divides the population into smokers and non-smokers and compares whether they have ever suffered from anxiety. About 27 percent of occasional smokers had anxiety disorders. About 22 percent of occasional smokers had anxiety disorders. About 19% of the never smokers had anxiety disorders. Looking at the graph, we can conclude that smokers are at least eight percent more likely to have anxiety disorders than non-smokers.

```{r}
df <- NHIS_final
df$Freq <-1
df = df %>% filter(Marital_Status !='Missing')
df = df %>% filter(Sex !='Missing' & Sex != "Do not know" & Sex != "Refused")
df = df %>% filter(History_of_Anxiety !='Missing' & History_of_Anxiety != "Do not know" & History_of_Anxiety != "Refused")
df = df %>% filter(Employment !='Missing' & Employment != "Do not know")
df = df %>% filter(Race !='Missing')
df = df %>% filter(Covid_Year !='Missing')
df = df %>% filter(Region !='Missing')
df = df %>% filter(History_of_Heart_disease !='Missing')
df = df %>% filter(History_of_Cancer !='Missing')
df = df %>% filter(History_of_Stroke !='Missing')
df = df %>% filter(Smoking !="Do not know" & Smoking != "Refused")
df = df %>% filter(Chronic_pain !="Do not know" & Chronic_pain!= "Refused")
df = df %>% filter(History_of_Diabetes !='Missing')
df = df %>% filter(History_of_Asthma !='Missing')
df = df %>% filter(Sexual_Orientation !='Missing' & Sexual_Orientation !='Missing')
df <- df %>% mutate_at(
                c('Sexual_Orientation'),  ~ case_when(
                                        . == "Others" ~ "LGBT+",
                                        . == "Straight" ~ "Straight",
                                        TRUE ~ "Straight"
                                        ))

```

## "Happier Work and Marriage: The Key to Reducing Anxiety?"
```{r}
options(dplyr.summarise.inform = FALSE)
df$Marital_Status  <- factor(df$Marital_Status,c('Unmarried','Married') )
df$Marital_Status <- as.ordered(df$Marital_Status)

icecreamcolors <- c("#E7BCC6", "#768CCe")

counts2 <- df %>%
  group_by(Employment,Marital_Status,History_of_Anxiety) %>%
  summarize(Freq = sum(Freq))

vcd::mosaic(History_of_Anxiety ~ Employment + Marital_Status, counts2,
            direction = c("v", "v", "h"),
            highlighting_fill = icecreamcolors)
```

Mosaic plots are used for visualizing data from two or more qualitative variables to show their proportions or associations. Based on the plot above, we can see that people who are unmarried and unemployed are more likely to have Anxiety than other people. At the same time, people who are unemployed have slightly higher chance to be unmarried.


## "Geography and the LGBT+ Community: Variations in Anxiety Risk"
```{r}
counts2 <- df %>%
  group_by(History_of_Anxiety,Sexual_Orientation,Region) %>%
  summarize(Freq = sum(Freq))

vcd::mosaic(History_of_Anxiety ~ Region + Sexual_Orientation, counts2,
            direction = c("h", "v", "h"),
            highlighting_fill = icecreamcolors)
```

Based on the plot, we can see that there is a lower concentration of LGBT+ individuals living in the southern and midwestern regions of the United States compared to other parts of the country. This may be due to a variety of factors, such as a lack of supportive communities or discrimination. However, the data also suggests that those who do live in the south and midwest are more likely to experience anxiety than those living in other regions. This could be a result of the challenges and barriers that they face in these areas, such as a lack of acceptance and support. Overall, this suggests that location can play a significant role in the mental health and well-being of LGBT+ individuals.






<!--chapter:end:results.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Interactive component
<iframe style="border-radius: 25px; border:none; background: #FDE6EC" src="interactiveHT.html" width="750" height="700"></iframe>

<!--chapter:end:interactive.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Conclusion


<!--chapter:end:conclusion.Rmd-->

